<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Hoho3D · Herramientas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Carga única de fuentes / iconos -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Tema base (header/nav) -->
  <style>
    :root{ --bg:#0b0c0f; --text:#e8ecf1; --muted:#a6adbb; --line:#1b1f28; --accent:#4f8cff; }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{ margin:0; font-family:Roboto, system-ui, -apple-system, Segoe UI, Arial, "Noto Sans", sans-serif; color:var(--text); background:linear-gradient(120deg,#0b0c0f,#0f1218); }
    .app-header{ position:sticky; top:0; z-index:10; display:flex; align-items:center; gap:16px;
      padding:12px 20px; border-bottom:1px solid var(--line); background:#0b0c0fd9; backdrop-filter:saturate(140%) blur(6px);}
    .app-header h1{ margin:0; font-size:16px; font-weight:600; letter-spacing:.2px; white-space:nowrap }
    .app-nav{ margin-left:auto; display:flex; gap:8px }
    .nav-btn{ appearance:none; border:1px solid var(--line); background:#12151d; color:var(--text);
      padding:8px 12px; border-radius:10px; cursor:pointer; font-size:14px }
    .nav-btn.is-active{ border-color:var(--accent); box-shadow:0 0 0 2px #000 inset }
    main{ max-width:1280px; margin:0 auto; padding:16px; }
    [hidden]{ display:none !important; }
  </style>

  <!-- Estilos de cada módulo (ya escopados) -->
  <link rel="stylesheet" href="./styles/color.css">
  <link rel="stylesheet" href="./styles/calc.css">
</head>
<body>
  <header class="app-header">
    <h1>Hoho3D · Herramientas</h1>
    <nav class="app-nav" role="tablist" aria-label="Herramientas Hoho3D">
      <button id="tab-color" data-target="#color-app" class="nav-btn is-active" role="tab" aria-selected="true" aria-controls="color-app">Color Finder</button>
      <button id="tab-calc" data-target="#calc-app" class="nav-btn" role="tab" aria-selected="false" aria-controls="calc-app">Calculadora de Costos</button>
    </nav>
  </header>

  <main>
    <!-- =========================
         SECCIÓN: Color Finder
         (tu index de Búsqueda por color + Ideas + Visor)
         Nota: el CSS/JS inline original se migró/escopó.
         ========================= -->
    <section id="color-app" role="tabpanel" aria-labelledby="tab-color"
             data-sheet-url="https://docs.google.com/spreadsheets/d/e/2PACX-1vTZ-GFIahnmzB09C1GWCvAs1PaNXmpN2_Ed5taWtseTRlqx0P8-ZKJ28TOsvziFOw/pub?output=tsv">
      <!-- Header propio del módulo -->
      <header>
        <h1>Búsqueda por color</h1>
      </header>

      <!-- App -->
      <main class="app">
        <!-- IZQUIERDA (rueda + barra V) -->
        <section class="left">
          <div class="pickers">
            <div class="vbar-wrap">
              <canvas id="vbar" width="28" height="300" aria-label="Luminosidad"></canvas>
            </div>
            <canvas id="wheel" width="320" height="320" aria-label="Rueda de color HSV"></canvas>
          </div>

          <div class="readout">
            <span class="dot" id="dot"></span>
            <span class="tag">RGB: <span id="sel-rgb" class="chip">—</span></span>
            <span class="tag">HEX: <input id="sel-hex" class="chip" style="border:1px solid #2b3a55; outline:none; width:160px" value="" /></span>
          </div>

          <img id="preview-img" class="img-preview" alt="Vista previa del filamento" />
        </section>

        <!-- DERECHA (detalles, filtros, sugerencias) -->
        <section class="card" id="main-card" aria-live="polite">
          <!-- Filtros -->
          <div class="filters">
            <select id="typeFilter" class="select" title="Filtrar por tipo">
              <option value="*">Tipos de filamento ▾</option>
              <option>PLA</option>
              <option>PLA+</option>
              <option>ABS</option>
              <option>PETG</option>
              <option>FLEX</option>
              <option>PLAFLEX</option>
            </select>
            <input id="q" class="input" type="search" placeholder="Buscar por color, marca o #hex" autocomplete="off" />
            <div id="sugs" class="suggestions" role="listbox" aria-label="Resultados"></div>
          </div>

          <div class="main-swatch" id="main-sw"></div>
          <h2 id="main-name" style="margin:0 0 6px 0; font-size:20px">—</h2>

          <div class="meta">
            <div><strong>Marca:</strong> <span id="main-brand">—</span></div>
            <div><strong>Tipo:</strong> <span id="main-type">—</span></div>
            <div><strong>Estilo:</strong> <span id="main-style">—</span></div>
            <div><strong>Temp.:</strong> <span id="main-temp">—</span></div>
            <div><strong>Resist.:</strong> <span id="main-strength">—</span></div>
            <div><strong>HEX:</strong> <span id="main-hex">—</span></div>
          </div>

          <!-- Acciones -->
          <div class="actions">
            <a id="main-link" class="btn btn-cta" href="#" target="_blank" rel="noopener">¡Comprar ahora!</a>
            <button id="ideas-btn" class="btn" type="button">Creador de Ideas</button>
            <label class="btn" for="refImage">Usa una imagen de referencia</label>
            <input id="refImage" type="file" accept="image/*" />
          </div>

          <div id="ideas-box" class="card" style="margin-top:12px; display:none">
            <h3 style="margin:0 0 8px 0; font-size:16px">Ideas</h3>
            <ul id="ideas-list" style="margin:0; padding-left:18px"></ul>
          </div>

          <article class="card" style="margin-top:14px">
            <h2 style="margin:0 0 8px 0; font-size:18px">Otras sugerencias</h2>
            <div class="subs">
              <div class="sub" id="sub-1">
                <div class="sw" id="sub1-sw"></div>
                <div>
                  <h3 id="sub1-name">—</h3>
                  <small id="sub1-desc">—</small>
                </div>
                <button class="btn btn-mini" id="sub1-btn">Ver</button>
              </div>
              <div class="sub" id="sub-2">
                <div class="sw" id="sub2-sw"></div>
                <div>
                  <h3 id="sub2-name">—</h3>
                  <small id="sub2-desc">—</small>
                </div>
                <button class="btn btn-mini" id="sub2-btn">Ver</button>
              </div>
            </div>
          </article>
        </section>
      </main>

      <!-- Lightbox producto -->
      <div class="lightbox" id="lightbox">
        <button class="close" id="lb-close">Cerrar</button>
        <img id="lb-img" alt="Imagen del filamento" />
      </div>

      <!-- Modal eyedropper -->
      <div class="modal" id="eyeModal">
        <div class="modal-card">
          <div class="modal-head">
            <h3>Selecciona un color desde tu imagen</h3>
            <div class="pill">Haz clic en la imagen para tomar el color exacto</div>
          </div>
          <canvas id="eyeCanvas" width="960" height="520"></canvas>
          <div class="actions" style="margin-top:10px; justify-content:flex-end">
            <button class="btn" id="eye-close">Cerrar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- =========================
         SECCIÓN: Calculadora de Costos Hoho 3D
         (tu index de la calculadora)
         Nota: se removieron CSS/JS inline para evitar colisiones.
         ========================= -->
    <section id="calc-app" role="tabpanel" aria-labelledby="tab-calc" hidden>
      <div class="container">
        <header>
          <h1>
            <i class="material-icons">calculate</i>
            Calculadora de Costos Hoho 3D
          </h1>
          <p class="subtitle">Calcula el costo real de tus impresiones 3D con todos los factores incluidos</p>
        </header>

        <div class="progress-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="card">
          <div class="tabs">
            <div class="tab active" data-tab="basic">
              <i class="material-icons">settings</i>
              Configuración Básica
            </div>
            <div class="tab" data-tab="printing">
              <i class="material-icons">print</i>
              Impresión
            </div>
            <div class="tab" data-tab="shipping">
              <i class="material-icons">local_shipping</i>
              Envío
            </div>
            <div class="tab" data-tab="results">
              <i class="material-icons">payments</i>
